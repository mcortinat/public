% ===== Document class & geometry =====
\documentclass{article}
\usepackage[top=1in, bottom=1in, left=1in, right=1in]{geometry}

% ===== Encoding & language =====
\usepackage[utf8]{inputenc} % <-- swap utf8x -> utf8
\usepackage[english]{babel}

% ===== Math =====
\usepackage{amsmath, amsfonts, amssymb, bm}
\usepackage{amsthm}

% ===== Tables & floats =====
\usepackage[table]{xcolor}
\usepackage{array, tabularx, booktabs, longtable, makecell, multirow}
% \usepackage{tabu} % <-- REMOVE: abandoned & buggy
\usepackage{caption}
\usepackage{subcaption} % keep this; DO NOT also load floatrow
% \usepackage[capposition=top]{floatrow} % <-- REMOVE: conflicts with subcaption

% ===== Graphics =====
\usepackage{graphicx}
\usepackage{pdflscape}
\usepackage{pdfpages}
\usepackage{rotating}
\usepackage{epstopdf}

% ===== Text, layout, headers/footers =====
\usepackage{setspace}
\usepackage{ragged2e}
\usepackage{fancyhdr}
\usepackage[normalem]{ulem}
\usepackage{enumerate}
\usepackage{framed}
\usepackage{comment}
\usepackage{titlesec}
\usepackage{titletoc} % load once
\usepackage{accents}
\usepackage{stackengine}
\usepackage{footmisc} % choose ONE footnote package
% \usepackage{footnote} % <-- REMOVE to avoid conflicts

% ===== Links (load near the end) =====
\usepackage[colorlinks=true,linkcolor=darkgray,citecolor=darkgray,urlcolor=darkgray,anchorcolor=darkgray]{hyperref}

% ===== Bibliography (natbib + BibTeX) =====
\usepackage[sort&compress]{natbib}
% \usepackage{bibunits} % <-- Usually unnecessary; remove unless you truly need per-section bibs

% ===== Colors & watermark (optional) =====
\definecolor{lightgray}{RGB}{220,220,220}
\definecolor{dimgray}{RGB}{105,105,105}
% \usepackage[printwatermark]{xwatermark} % optional; safe to keep disabled

% ===== Section formats =====
\titlespacing{\section}{.2pt}{1ex}{1ex}
\titleformat{\section}{\centering \normalsize \bfseries}{\thesection.}{0em}{}
\renewcommand{\thesection}{\arabic{section}}
\titleformat{\subsection}{\flushleft \normalsize \bfseries}{\thesubsection}{0em}{}
\renewcommand{\thesubsection}{\arabic{section}.\arabic{subsection}}

% ===== Theorems =====
\newtheoremstyle{mytheoremstyle}
{\topsep}{\topsep}{\color{black}}{}{\itshape\color{dimgray}}{.}{.5em}{}
\theoremstyle{mytheoremstyle}
\newtheorem{assumption}{Assumption}
\renewcommand\theassumption{\arabic{assumption}}
\newtheorem{assumptiona}{Assumption}
\renewcommand\theassumptiona{\arabic{assumptiona}a}
\newtheorem{assumptionb}{Assumption}
\renewcommand\theassumptionb{\arabic{assumptionb}b}
\newtheorem{assumptionc}{Assumption}
\renewcommand\theassumptionc{\arabic{assumptionc}c}
\newtheorem{lemma}{Lemma}
\newtheorem{proposition}{Proposition}
\newtheorem{corollary}{Corollary}

% ===== Math operators & handy commands =====
\DeclareMathOperator{\cov}{Cov}
\DeclareMathOperator{\sign}{sgn}
\DeclareMathOperator{\var}{Var}
\DeclareMathOperator{\plim}{plim}
\DeclareMathOperator*{\argmin}{arg\,min}
\DeclareMathOperator*{\argmax}{arg\,max}
\newcommand\independent{\protect\mathpalette{\protect\independenT}{\perp}}
\def\independenT#1#2{\mathrel{\rlap{$#1#2$}\mkern2mu{#1#2}}}
\newcommand{\overbar}[1]{\mkern 1.5mu\overline{\mkern-1.5mu#1\mkern-1.5mu}\mkern 1.5mu}
\newcommand{\equald}{\ensuremath{\overset{d}{=}}}
\newcommand\barbelow[1]{\stackunder[1.2pt]{$#1$}{\rule{1ex}{.085ex}}}

% ===== Captions =====
\captionsetup[table]{skip=10pt}
\captionsetup[figure]{labelfont={bf},name={Figure},labelsep=period}
\renewcommand{\thefigure}{\arabic{figure}}
\captionsetup[table]{labelfont={bf},name={Table},labelsep=period}
\renewcommand{\thetable}{\arabic{table}}

% ===== Paragraphing, spacing, column types =====
\setlength{\parindent}{24pt} % (you had both 22pt and 24ptâ€”choose one)
\setlength{\parskip}{5pt}
\newcolumntype{L}[1]{>{\raggedright\let\newline\\\arraybackslash\hspace{0pt}}m{#1}}
\newcolumntype{C}[1]{>{\centering\let\newline\\\arraybackslash\hspace{0pt}}m{#1}}
\newcolumntype{R}[1]{>{\raggedleft\let\newline\\\arraybackslash\hspace{0pt}}m{#1}}

% ===== REMOVE the risky patch (likely cause of \endgroup) =====
% \makeatletter
% \pretocmd\start@align{ \let\everycr\CT@everycr \CT@start }{}{}
% \apptocmd{\endalign}{\CT@end}{}{}
% \makeatother
